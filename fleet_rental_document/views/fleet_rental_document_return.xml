<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>

      <record id='view_fleet_rental_document_return_tree' model='ir.ui.view'>
        <field name="name">fleet.rental.document.return.tree</field>
        <field name="model">fleet_rental.document_return</field>
        <field name="arch" type="xml">
          <tree string="Vehicle Return">
            <field name="state" invisible="1"/>
            <field name="name"/>
            <field name="partner_id"/>
            <field name="vehicle_id"/>
            <field name="exit_datetime"/>
            <field name="return_datetime"/>
            <field name="total_rental_period"/>
          </tree>
        </field>
      </record>

      <record id='fleet_rental_return_document_draft_act' model='ir.actions.act_window'>
        <field name="name">Return Draft</field>
        <field name="res_model">fleet_rental.document_return</field>
        <field name="view_type">form</field>
        <field name="view_id" ref="view_fleet_rental_document_return_tree"/>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('state','in',('draft',))]</field>
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Click to create a new rental document.
          </p>
        </field>
      </record>

      <menuitem action="fleet_rental_return_document_draft_act" parent="fleet_rental_document.fleet_rental_sale" id="return_draft_menu" sequence="7"/>

      <record id='fleet_rental_return_document_open_act' model='ir.actions.act_window'>
        <field name="name">Return Open</field>
        <field name="res_model">fleet_rental.document_return</field>
        <field name="view_type">form</field>
        <field name="view_id" ref="view_fleet_rental_document_return_tree"/>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('state','in',('open',))]</field>
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Click to create a new rental document.
          </p>
        </field>
      </record>

      <menuitem action="fleet_rental_return_document_open_act" parent="fleet_rental_document.fleet_rental_sale" id="return_open_menu" sequence="8"/>

      <record id='fleet_rental_return_documnet_closed_act' model='ir.actions.act_window'>
        <field name="name">Return Closed</field>
        <field name="res_model">fleet_rental.document_return</field>
        <field name="view_type">form</field>
        <field name="view_id" ref="view_fleet_rental_document_return_tree"/>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('state','in',('closed',))]</field>
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Click to create a new rental document.
          </p>
        </field>
      </record>

      <menuitem action="fleet_rental_return_documnet_closed_act" parent="fleet_rental_document.fleet_rental_sale" id="return_closed_menu" sequence="9"/>

      <record id='fleet_rental_return_document_form' model='ir.ui.view'>
        <field name="name">fleet.rental.document.return.form</field>
        <field name="model">fleet_rental.document_return</field>
        <field name="arch" type="xml">
          <form string="Vehicle Return">
            <header>
                <button name="%(action_view_make_invoice_wizard)d" string="Create Invoice"
                        type="action" class="btn-primary"
                        states="open"/>
                <button name="action_open" states="draft" string="Return Car and keep contract open" type="object"/>
                <button name="action_create_refund"
                        type='object'
                        string='Create Refund'
                        class="btn-primary"
                        groups="base.group_user"
                        states="open"/>
                <field name="state" widget="statusbar" statusbar_visible="draft,open,closed"/>
            </header>
            <sheet>
              <div class="oe_button_box" name="button_box">
                <button name="action_view_invoice"
                        type="object"
                        class="oe_stat_button"
                        icon="fa-pencil-square-o"
                        attrs="{'invisible': [('invoice_count', '=', 0)]}">
                  <field name="invoice_count" widget="statinfo" string="Invoices"/>
                </button>
              </div>
              <div class="oe_title">
                <h1>
                  <field name="name" readonly="1"/>
                </h1>
              </div>
              <group>
                <field name="partner_id" readonly="1"/>
              </group>
              <group>
                <group col="2" string="Vehicle Information">
                  <field name="vehicle_id" readonly="1"/>
                  <field name="rent_return_datetime" invisible="1"/>
                  <field name="allowed_kilometer_per_day"/>
                  <field name="rate_per_extra_km"/>
                  <field name="daily_rental_price"/>
                  <field name="extra_driver_charge_per_day" class="oe_inline"/>
                  <field name="odometer_before" string="Odometer before Rent"/>
                  <field name="odometer_after"/>
                  <field name="exit_datetime" class="oe_inline" readonly="1"/>
                  <field name="return_datetime" class="oe_inline"/>
                  <field name="total_rental_period" class="oe_inline"/>
                  <field name="extra_hours" class="oe_inline"
                         attrs="{'invisible': [('extra_hours', '=', 0)]}"/>
                  <field name="extra_kilometers" class="oe_inline"/>
                </group>
                <group col="2" string="Payment Details">
                  <field name="period_rent_price" class="oe_inline"/>
                  <field name="extra_driver_charge" class="oe_inline"/>
                  <field name="other_extra_charges" class="oe_inline"/>
                  <field name="penalties" class="oe_inline"/>
                  <field name="extra_hours_charge" class="oe_inline"/>
                  <field name="extra_kilos_charge" class="oe_inline"/>
                  <field name="total_rent_price" class="oe_inline"/>
                  <field name="discount" class="oe_inline"/>
                  <field name="price_after_discount" class="oe_inline"/>
                  <field name="advanced_deposit" class="oe_inline"/>
                  <field name="balance" class="oe_inline"/>
                </group>
              </group>
              <notebook>
                <page string="Vehicle Checklist">
                  <field name="check_line_ids" widget="one2many_list" colspan="4" nolabel="1" mode="tree">
                    <tree string="Vehicle checklist" editable="bottom" create="0" delete="false"  decoration-danger="return_check_yes and return_check_no" decoration-success="return_check_yes and not return_check_no" decoration-warning="(not return_check_yes) and return_check_no">
                      <field name="item_id" options='{"no_open": true}'/>
                      <field name="exit_check_yes" readonly="1"/>
                      <field name="exit_check_no" readonly="1"/>
                      <field name="return_check_yes"/>
                      <field name="return_check_no"/>
                    </tree>
                  </field>
                </page>
              </notebook>
            </sheet>
          </form>
        </field>
      </record>

    </data>
</openerp>
