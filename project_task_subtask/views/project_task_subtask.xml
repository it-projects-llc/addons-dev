<?xml version="1.0" encoding="utf-8"?>
<openerp>
  <data>
    <record id="view_task_form2" model="ir.ui.view">
      <field name="name">project.task.form</field>
      <field name="model">project.task</field>
      <field name="inherit_id" ref="project.view_task_form2"/>
      <field name="arch" type="xml">
        <xpath expr = "//page[last()]" position = "after">
          <page string = "Subtasks">
            <field name="subtask_ids">
              <tree string="Task Work" editable="top">
                <field name="name"/>
                <field name="reviewer_id"/>
                <field name="user_id"/>
                <field name="state"/>
               <!-- <field name="done"/> -->
              </tree>
            </field>
          </page>
        </xpath>
      </field>
    </record>

    <record model="ir.ui.view" id="view_id">
      <field name="name">project.task.subtask</field>
      <field name="model">project.task.subtask</field>
      <field name="arch" type="xml">
        <form string="Subtask Message">
          <sheet>
            <group>
              <field name="name"/>
              <!-- <field name="done"/> -->
              <field name="state"/>
              <div class="oe_chatter">
                <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                <field name="message_ids" widget="mail_thread"/>
              </div>
            </group>
          </sheet>
        </form>
      </field>
    </record>

    <record id="project_task_subtask_view_search" model="ir.ui.view">
      <field name="name">project.task.subtask.filter</field>
      <field name="model">project.task.subtask</field>
      <field name="arch" type="xml">
        <search string="Filter">
          <filter string="My" domain="[('user_id','=',uid)]" name="my_subtask"/>
          <separator/>
          <filter string="TODO" domain="[('state','=','todo')]" name="done_subtask"/>
          <group expand="0" string="Group By">
            <filter string="Project" domain="[]" context="{'group_by':'project_id'}"/>
            <filter string="Task" domain="[]" context="{'group_by':'task_id'}"/>
          </group>
        </search>
      </field>
    </record> 

    <record id="action_view_subtask" model="ir.actions.act_window">
      <field name="name">Subtask</field>
      <field name="res_model">project.task.subtask</field>
      <field name="view_mode">tree,form</field>
      <field name="context">{
      'search_default_my_subtask': 1,
      'search_default_done_subtask': 1, 
      }
      </field>
    </record> 

    <menuitem name="Subtask"
              parent="project.menu_project_management"
              id="menu_action_view_subtask"
              action="action_view_subtask"/>
    
  </data>
</openerp>
