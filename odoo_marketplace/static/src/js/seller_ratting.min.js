$(document).ready(function(){$(".avg-rating-cir").percentcircle({animate:!0,diameter:130,guage:6,coverBg:"#fff",bgColor:"#efefef",fillColor:"#E95546",percentSize:"15px",percentWeight:"normal"}),$(".recommendation-cir").percentcircle({animate:!0,diameter:130,guage:6,coverBg:"#fff",bgColor:"#efefef",fillColor:"#5bc0de",percentSize:"15px",percentWeight:"normal"}),odoo.define("odoo_marketplace.seller_review",function(e){"use strict";var t=e("web.ajax"),s=e("web.core")._t;$("#rating-star").rating({starCaptions:{1:s("Poor"),2:s("Ok"),3:s("Good"),4:s("Very Good"),5:s("Excellent")},starCaptionClasses:{1:"text-danger badge badge-danger",2:"text-warning badge badge-warning",3:"text-info badge badge-info",4:"text-seconday badge badge-primary",5:"text-success badge badge-success"}}),$("#btn-create-review").on("click",function(e){var l=$("#rating-star").val(),i=$("#title").val().trim(),r=$("#summary").val().trim();l<=0?($("#submit-msg").empty(),$("#submit-msg").html(s(" Please add your rating !!!")),$("#submit-msg").addClass("alert-danger submit-error-msg fa fa-exclamation-triangle"),$("#submit-msg").show()):""==i?($("#review-title-box").addClass("has-error"),$("#submit-msg").html(s(" Review title is required field.")),$("#submit-msg").addClass("alert-danger submit-error-msg fa fa-exclamation-triangle"),$("#submit-msg").show()):""==r?($("#review-title-box").removeClass("has-error"),$("#submit-msg").empty(),$("#review-summary-box").addClass("has-error"),$("#submit-msg").html(s(" Review is required field.")),$("#submit-msg").addClass("alert-danger submit-error-msg"),$("#submit-msg").show()):($("#review-summary-box").removeClass("has-error alert-danger submit-error-msg"),t.jsonRpc("/seller/review/check","call",{seller_id:a}).then(function(e){if("boolean"==jQuery.type(e)){$("#btn-create-review").addClass("disabled");var o=$("#btn-create-review").html();$("#btn-create-review").html('<i class="fa fa-refresh fa-spin"></i> Posting...'),t.jsonRpc("/seller/review","call",{seller_id:a,stars:l,title:i,review:r}).then(function(e){$("#mp-review-form").trigger("reset"),e?($("#submit-msg").html(e),$("#submit-msg").removeClass("alert-danger alert-warning"),$("#submit-msg").addClass("alert-success submit-error-msg fa fa-check-circle"),setTimeout(function(){$("#submit-msg").hide()},3500)):($("#submit-msg").html(s("  Your review has been submitted successfully. Thank you!")),$("#submit-msg").removeClass("alert-danger alert-warning"),$("#submit-msg").addClass("alert-success submit-error-msg fa fa-check-circle"),setTimeout(function(){$("#submit-msg").hide()},3500)),$("#btn-create-review").removeClass("disabled"),$("#btn-create-review").html(o)})}else $("#submit-msg").html(e),$("#submit-msg").removeClass("alert-danger"),$("#submit-msg").addClass("alert-warning submit-error-msg fa fa-exclamation-triangle")}))}),$(document).on("keyup","#review-title-box",function(){$("#review-title-box").removeClass("has-error"),$("#submit-msg").removeClass(" alert-danger submit-error-msg fa fa-exclamation-triangle fa-check-circle alert-success"),$("#submit-msg").empty()}),$(document).on("keyup","#review-summary-box",function(){$("#review-summary-box").removeClass("has-error"),$("#submit-msg").removeClass("alert-danger submit-error-msg fa fa-exclamation-triangle alert-warning fa-check-circle alert-success"),$("#submit-msg").empty()});var l="recent",i=-1,r=0,a=parseInt($("#seller_all_review").find('input[type="hidden"][name="seller_id"]').first().val(),10);$("#mp-load-morebtn").on("click",function(e){parseInt($("#select_star").val(),10);var s=$("#total_seller_reviews").html(),o=parseInt($("#seller_all_review").find('input[type="hidden"][name="limit"]').first().val(),10);r+=o,$("#mp-load-morebtn").hide(),$("#mp-load-morebtn-loder").show(),t.jsonRpc("/seller/load/review","call",{seller_id:a,offset:r,limit:o,sort_by:l,filter_by:i}).then(function(e){$(e).appendTo(".mp-box-review"),$("#mp-load-morebtn-loder").hide(),$("#mp-load-morebtn").show()}),t.jsonRpc("/seller/load/review/count","call",{seller_id:a,offset:r,limit:o,sort_by:l,filter_by:i}).then(function(e){e[0]>0&&$("#viewed").text(r+e[0]),s==r+e[0]&&$("#mp-load-more-div").hide()})}),$("#select_star").on("click",function(e){r=0;i=parseInt($("#select_star").val(),10);var s=parseInt($("#seller_all_review").find('input[type="hidden"][name="limit"]').first().val(),10);$("#total_seller_reviews").html();$(".mp-box-review_loader").show(),t.jsonRpc("/seller/load/review","call",{seller_id:a,offset:0,limit:s,sort_by:l,filter_by:i}).then(function(e){var t=$(e);$(".mp-box-review").html(t),$(".mp-box-review_loader").hide()}),t.jsonRpc("/seller/load/review/count","call",{seller_id:a,offset:r,limit:s,sort_by:l,filter_by:i}).then(function(e){$("#viewed").text(0+e[0]),e[1]==0+e[0]?$("#mp-load-more-div").hide():$("#mp-load-more-div").show(),$("#total_seller_reviews").text(e[1])})}),$("#most_helpful_tab").on("click",function(e){r=0,l="most_helpful";var s=parseInt($("#seller_all_review").find('input[type="hidden"][name="limit"]').first().val(),10);$("#total_seller_reviews").html();$("#most_recent_tab").removeClass("active-sort-tab"),$("#most_helpful_tab").addClass("active-sort-tab"),$(".mp-box-review_loader").show(),t.jsonRpc("/seller/load/review","call",{seller_id:a,offset:0,limit:s,sort_by:l,filter_by:i}).then(function(e){var t=$(e);$(".mp-box-review").html(t),$(".mp-box-review_loader").hide()}),t.jsonRpc("/seller/load/review/count","call",{seller_id:a,offset:0,limit:s,sort_by:l,filter_by:i}).then(function(e){e[0]&&$("#viewed").text(0+e[0]),e[1]==0+e[0]?$("#mp-load-more-div").hide():$("#mp-load-more-div").show()})}),$("#most_recent_tab").on("click",function(e){r=0,l="recent";var s=parseInt($("#seller_all_review").find('input[type="hidden"][name="limit"]').first().val(),10);$("#total_seller_reviews").html();$("#most_helpful_tab").removeClass("active-sort-tab"),$("#most_recent_tab").addClass("active-sort-tab"),$(".mp-box-review_loader").show(),t.jsonRpc("/seller/load/review","call",{seller_id:a,offset:0,limit:s,sort_by:l,filter_by:i}).then(function(e){var t=$(e);$(".mp-box-review").html(t),$(".mp-box-review_loader").hide()}),t.jsonRpc("/seller/load/review/count","call",{seller_id:a,offset:0,limit:s,sort_by:l,filter_by:i}).then(function(e){e[0]&&$("#viewed").text(0+e[0]),e[1]==0+e[0]?$("#mp-load-more-div").hide():$("#mp-load-more-div").show()})}),$("body").on("click",".mp-sprite",function(e){var s=$(this).closest(".seller-review-bottom");if($(this).hasClass("mp-TopLeft")){$(this).removeClass("mp-TopLeft"),$(this).addClass("mp-BottomLeft");var l=parseInt($(this).closest(".seller_review_div").find("#seller_review_id").val(),10),i=1;return t.jsonRpc("/seller/review/help","call",{seller_review_id:l,review_help:i}).then(function(e){e&&(s.find(".review_helpful").text(e[0]),s.find(".review_not_helpful").text(e[1]))}),void $(".seller_review_div .mp-BottomRight").addClass("mp-TopRight").removeClass("mp-BottomRight")}if($(this).hasClass("mp-TopRight")){$(this).removeClass("mp-TopRight"),$(this).addClass("mp-BottomRight");var l=parseInt($(this).closest(".seller_review_div").find("#seller_review_id").val(),10),i=-1;return t.jsonRpc("/seller/review/help","call",{seller_review_id:l,review_help:i}).then(function(e){e&&(s.find(".review_not_helpful").text(e[1]),s.find(".review_helpful").text(e[0]))}),void $(".seller_review_div .mp-BottomLeft").addClass("mp-TopLeft").removeClass("mp-BottomLeft")}if($(this).hasClass("mp-BottomLeft")){$(this).removeClass("mp-BottomLeft"),$(this).addClass("mp-TopLeft");var l=parseInt($(this).closest(".seller_review_div").find("#seller_review_id").val(),10),i=2;t.jsonRpc("/seller/review/help","call",{seller_review_id:l,review_help:i}).then(function(e){e&&(s.find(".review_helpful").text(e[0]),s.find(".review_not_helpful").text(e[1]))})}else if($(this).hasClass("mp-BottomRight")){$(this).removeClass("mp-BottomRight"),$(this).addClass("mp-TopRight");var l=parseInt($(this).closest(".seller_review_div").find("#seller_review_id").val(),10),i=-2;t.jsonRpc("/seller/review/help","call",{seller_review_id:l,review_help:i}).then(function(e){e&&(s.find(".review_not_helpful").text(e[1]),s.find(".review_helpful").text(e[0]))})}else;}),$("#recommend-yes").on("click",function(e){t.jsonRpc("/seller/recommend","call",{seller_id:a,recommend_state:"yes"}).then(function(e){}),$(this).removeClass("btn-info"),$(this).addClass("btn-success"),$("#recommend-no").removeClass("btn-success"),$("#recommend-no").addClass("btn-info"),$("#seller-recommend").addClass("hide-comment"),$("#recommend-vote").removeClass("hide-comment")}),$("#recommend-no").on("click",function(e){t.jsonRpc("/seller/recommend","call",{seller_id:a,recommend_state:"no"}).then(function(e){}),$(this).removeClass("btn-info"),$(this).addClass("btn-success"),$("#recommend-yes").removeClass("btn-success"),$("#recommend-yes").addClass("btn-info"),$("#seller-recommend").addClass("hide-comment"),$("#recommend-vote").removeClass("hide-comment")}),$("#open-review-tab").click(function(e){e.preventDefault(),$('#shop-nav-tabs a[href="#rating_review_tab"]').tab("show"),$("html,body").animate({scrollTop:$("#seller-info-pannel").offset().top},"slow")}),$(document).ready(function(){$("abbr.timeago").timeago()}),$(document).on("click",".seller-review-write-comments",function(){var e=$(this).closest(".seller_review_div");"none"!=e.find("section.mb32.hidden-print").css("display")?e.find("section.mb32.hidden-print").hide():e.find("section.mb32.hidden-print").show()}),$(document).on("click",".seller-review-comments",function(){var e=$(this).closest(".seller_review_div");"none"!=e.find("ul.media-list.marketplace_mail_comments li.media").css("display")?e.find("ul.media-list.marketplace_mail_comments li.media").hide():e.find("ul.media-list.marketplace_mail_comments li.media").show()}),$("body").on("click",".marketplace_chatter_json",function(e){e.preventDefault();var s=this,l=$(this).closest(".seller_review_div"),i=$(this).closest("form"),r=$(this).closest(".o_website_chatter_error"),a=$(this).closest(".seller_review_div"),o=parseInt(a.find('input[type="hidden"][name="seller_review_id"]').first().val(),10),n=String(a.find('input[type="hidden"][name="res_model"]').first().val(),10),m=String(a.find('textarea[name="message"]').first().val(),10),d=i.serializeArray(),c={};if($.map(d,function(e,t){c[e.name]=e.value}),c.message=c.message.replace(/\n/g,"<br/>"),c.message){$(this).closest(".marketplace_chatter_json").attr("disabled",!0);var v=$(this).closest(".marketplace_chatter_json").html();$(this).closest(".marketplace_chatter_json").prepend('<i class="fa fa-refresh fa-spin"></i> '),t.jsonRpc("/marketplace_mail/post/json","call",{res_model:n,res_id:o,message:m}).then(function(e){$(e);e?(r.fadeOut(),l.find(".marketplace_mail_comments").prepend(e),i.find("textarea").val("")):r.fadeIn(),$(s).closest(".marketplace_chatter_json").html(v),$(s).closest(".marketplace_chatter_json").attr("disabled",!1)})}})})});
